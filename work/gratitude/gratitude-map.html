<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Gratitude powers DC</title>
	<link rel="shortcut icon" href="https://dc.gov/sites/default/files/favicon_0.ico" type="image/vnd.microsoft.icon" />

	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="css/leaflet-search.css" />
	<link href="css/gratitudeMap.css?version=1" rel="stylesheet" />
	<link href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" rel="stylesheet" crossorigin="" />

	<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
	<script src="https://kit.fontawesome.com/c7aaba00fa.js" crossorigin="anonymous"></script>
	<script src="js/leaflet-search.js"></script>
</head>

<body>
	<header id="section-header">
		DC Innovation Team's header went here
	</header>
	<div class="mapContent">
		<h1 aria-hidden="true" class="alternateH1">Gratitude Powers DC</h1>

		<div class="searchOuterContainer">
			<div id="searchContainer"><span class="hidden">Drupal removes empty DIVs so need something here</span></div>
		</div>

		<div class="mapContainer" id="mapContainer">&nbsp;</div><!--
		Do not remove comment or whitespace between inline-block elements will break layout
		--><div class="placeInfo" id="placeInfo"><a aria-label="Close" class="closeButton" href="#" id="closeButton" role="button"><span>&nbsp;</span></a>

			<h1>Gratitude Powers DC</h1>

			<div id="introText">
				<p>Welcome to the Gratitude Map, brought to you by the Mayor&#39;s Office of Innovation (MOI). MOI launched a gratitude survey to uncover the people, places, and things that those who work, live, and play in the District of Columbia are grateful for.</p>
				<p><span class="hideMobile">Click</span><span class="hideDesktop">Dismiss this message and tap</span> a marker on the map to see places that residents are grateful for. Zoom in and out like Google Maps; click on the <strong>Legend</strong> button at the bottom-left to see the categories.</p>
			</div>

			<div class="photoContainer hidden"><img alt="" src="https://moi.dc.gov/sites/default/files/dc/sites/MOPI/page_content/images/pixel.png" />
				<p class="caption" id="caption">&nbsp;</p>
			</div>

			<h2 class="displayName hidden">Accessibility checker complains about empty header despite display:none</h2>

			<div class="quoteContainer hidden">&nbsp;</div>

			<p class="learnMoreContainer hidden">To learn more: <a class="ext" href="#" id="learnMoreLink" target="_blank">Must have something here or Drupal will delete it!</a></p>

			<p class="surveyLink">Do want to tell us about something in D.C. you are grateful for? <br>
				[Sorry, you are too late. There used to be a link to the survey.]</p>
				<p>Some <a href="#" id="techDetailsLink">technical details</a>.</p>
		</div><!--
		Do not remove comment or whitespace between inline-block elements will break layout
		--><div class="overlay hidden" id="overlay"></div>
		<div class="overlayContent hidden" id="overlayContent">
			<a aria-label="Close" class="closeButton" href="#" id="closeOverlayBtn" role="button"><span>&nbsp;</span></a>
			<h1>About this project</h1>
			<p>
				Since Bloomberg Philanthropy funded our team and they have an interest in telling the story of their work through
				public art, they directed us to hire an artist which my boss resisted for a long time as we had no idea what that 
				person would do. Eventually, they came up with focusing on &ldquo;gratitude&rdquo; and part of the project was to 
				get DC residents to complete a survey asking them about something they are grateful for. Where those things were 
				places, we could put them on a map and so this page was born.
			</p>
			<p>
				One of my coworkers reviewed all the results and if it was a place, used DC's 
				<a href="https://octo.dc.gov/service/master-address-repository" target="blank">Master Address Repository</a>
				to get latitude and longitude. I would try and find a photo we could legally use, though sometimes that meant 
				taking it myself. I was then given a .csv file which needed to be turned into this 
				<a href="http://localhost/sweetandsour/work/gratitude/js/gratitudeMapData.js" target="_blank">JSON file</a>.
			</p>
			<p>
				For that, I used a series of regular expressions on <a href="https://regex101.com" target="blank">regex101</a>
				using the output of one substitution as the input for the next. They were:
			</p>
			<ol>
				<li>
					RegEx:<br>Story [0-9]+: (?'quote'.*)\n*
					<br>
					Substitution:<br>&lt;p&gt;&ldquo;${quote}&rdquo;&lt;/p&gt;
				</li>
				<li>
					RegEx:<br>^(?'groupId'[0-9]{1,3}),(?'displayName'[^,]+),(?'website'[^,]*),(?'street'\?\?\?|[0-9 a-zA-Z.#]*),(?'city'\?\?\?|[ a-zA-Z]*),(?'state'\?\?\?|(?:[A-Z]{2})?),(?'zipCode'\?\?\?|(?:[0-9]{5})?),(?'numberOfCitations'[0-9]{1,2}),"(?'quote'[^"\n]*)\n*",(?'latitude'38\.[0-9]{3,8}),(?'longitude'-7[6|7]\.[0-9]{3,8}),"?(?'caption'[^,"]*(?:(?:""|, )[^,"]*)*),(?'photoURL'.*),(?'categoryName'[\-a-zA-Z ]*),Cluster (?'neighborhoodClusterId'[0-9]+),"?(?'neighborhoodClusterComponents'[\-\/,.' a-zA-Z]+?)"?,(?'categoryId'[0-9]+)$
					<br>
					Substitution:<br>{\n\t"latitudeLongitude": [${latitude}, ${longitude}], \n\t"displayName": "${displayName}", \n\t"quote": "${quote}", \n\t"numberOfCitations": ${numberOfCitations}, \n\t"website": "${website}",\n\t"photoUrl": "${photoURL}",\n\t"altText": "Photo of the ${displayName}",\n\t"caption": "${caption}",\n\t"categoryId": ${categoryId},\n\t"categoryName": "${categoryName}",\n\t"neighborhoodClusterId": ${neighborhoodClusterId},\n\t"neighborhoodClusterComponents": "${neighborhoodClusterComponents}"\n},
				</li>
				<li>
					RegEx:<br>""https
					<br>
					Substitution:<br>\\"https
				</li>
				<li>
					RegEx:<br>"">
					<br>
					Substitution:<br>\\">
				</li>
				<li>
					RegEx:<br>Photo credit: ""
					<br>
					Substitution:<br>Photo credit: "https://innovate.dc.gov/sites/default/files/dc/sites/MOPI/abstractImage600x800.jpg"
				</li>
			</ol>
			<p>
				I used the <a href="https://leafletjs.com/" target="_blank">Leaflet</a> mapping library but then it was considerable work to place the 
				marker pins with the right icon and color, create the legend that allows display of specific categoery, getting the search to work and so on. 
				The traffic generated was trivial so the only real benefit is that I learned something and can display it here.
			</p>
		</div>
	</div>

	
	
	<script type="module" src="js/gratitudeMap.js"></script>
</body>
</html>