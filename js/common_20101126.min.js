/* See common_20101126.js for uncompressed version */
var SweetAndSour=(function(){var q;var z;var v=0;var h=0;var g=0;function c(M,K,H,J){if(M.length>K){if(!H){H=" ..."}if(!J){J=12}var L=M.substring(0,K-H.length);var F;var G;for(var I=0;I<J;I++){if(I<L.length){G=L.length-I;F=L.charAt(G);if(/\s/i.test(F)){return L.substring(0,G)+H}}}return L+H}else{return M}}function o(){var G=0;var F=0;if(self.pageYOffset){G=self.pageXOffset;F=self.pageYOffset}else{if(document.documentElement&&document.documentElement.scrollTop){G=document.documentElement.scrollLeft;F=document.documentElement.scrollTop}else{if(document.body){G=document.body.scrollLeft;F=document.body.scrollTop}}}return({x:G,y:F})}function p(H){var G=0;var F=0;if(H&&H.offsetParent){G=H.offsetLeft;F=H.offsetTop;while(H.offsetParent!==null){H=H.offsetParent;G+=H.offsetLeft;F+=H.offsetTop}}return({x:G,y:F})}function m(G){var F=document.cookie.indexOf(G);if(F==-1){return null}else{var J=F+G.length+1;var H=document.cookie.indexOf(";",J+1);if(H==-1){H=document.cookie.length}var I=document.cookie.substring(J,H);return I}}function n(){window.clearTimeout(g);g=window.setTimeout(u,200)}function u(){var M=p(q);var K=M.x;var I=M.y;var H=o();var G=Number(H.x)+Number(h);var F=Number(H.y)+Number(v);var L=(G-K);var J=(F-I);if(L!==0||J!==0){q.style.left=(K+L)+"px";q.style.top=(I+J)+"px"}}function i(){var G=m("windowPosition");var F=o();if(G!==null){h=G.split(":")[0];v=G.split(":")[1]}else{var H=p(q);h=H.x-F.x;v=H.y-F.y}q.style.left=Number(F.x)+Number(h)+"px";q.style.top=Number(F.y)+Number(v)+"px"}function B(){var I=p(q);var G=o();h=I.x-G.x;v=I.y-G.y;if(v<10){v=10}var F=new Date();F.setFullYear(F.getFullYear()+1);var H="windowPosition="+h+":"+v+"; expires= "+F.toGMTString()+"; path=/";document.cookie=H}function b(){var H=q.offsetWidth;var G=q.getElement("div.clientArea");var J=G.offsetHeight;q.style.height="auto";G.style.width="auto";var F=new Date();F.setFullYear(F.getFullYear()+1);var I="windowSize="+H+":"+J+"; expires= "+F.toGMTString()+"; path=/";document.cookie=I}function t(){var G=q.getElement("div.clientArea");q.style.height="auto";G.style.width="auto";var F=m("windowSize");if(F!==null){q.style.width=F.split(":")[0]+"px";G.style.height=F.split(":")[1]+"px"}else{if(screen.availWidth<1000){q.style.width="760px";G.style.height="455px"}}}function w(){var F=q.getElement("div.dragBarLeft");var I=q.getElement("div.dragBarBottom");var G=q.getElement("div.dragBarRight");var H=q.getSize();F.style.height=(H.y-4)+"px";I.style.width=(H.x-4)+"px";G.style.height=(H.y-4)+"px"}function j(){var H=document.createElement("div");H.id="overlay";$("menuWrapper").appendChild(H);var I=document.createElement("div");I.id="loading";var G=document.createElement("img");G.src="http://sweetandsour.org.s3.amazonaws.com/images/loading_20080830.gif";G.setAttribute("alt","Just a moment ...");var F=document.createElement("p");F.innerHTML="Just a moment &hellip;";I.appendChild(G);I.appendChild(F);$("menuWrapper").appendChild(I)}function s(){var F=$("imageMenu").getElements("a");F.each(function(H,G){H.addEvent("click",function(){$("overlay").style.display="block";$("loading").style.display="block";IMSubNav.activate1=null;IMSubNav.reset1=null;IMSubNav.activate2=null;IMSubNav.reset2=null})})}function k(F){var H,G;F.each(function(I){H=I.getElements("div.photoBox");G=H.length;H.each(function(L,K){if(((K+1)%5===0)&&(K!=G-1)){var J=new Element("br",{clear:"all"});J.inject(L,"after")}})})}function l(F){var G=F.target;if(G.innerHTML.indexOf("Show")===0){G.innerHTML=G.innerHTML.replace(/Show/,"Hide");G.parentNode.parentNode.getElement("div.listing").style.display="block"}else{G.innerHTML=G.innerHTML.replace(/Hide/,"Show");G.parentNode.parentNode.getElement("div.listing").style.display="none"}}function x(G,H){var F=document.createElement("script");F.type="text/javascript";if(F.readyState){F.onreadystatechange=function(){if(F.readyState=="loaded"||F.readyState=="complete"){F.onreadystatechange=null;H()}}}else{F.onload=function(){H()}}F.src=G;document.body.appendChild(F)}function f(){if(Browser.Engine.trident){var G=new Element("span",{id:"bgTopLeft"}).addClass("roundedCorner");var J=new Element("span",{id:"bgTopRight"}).addClass("roundedCorner");var F=new Element("span",{id:"bgBottomLeft"}).addClass("roundedCorner");var I=new Element("span",{id:"bgBottomRight"}).addClass("roundedCorner");var H=$$("div.page")[0];H.appendChild(G);H.appendChild(J);H.appendChild(F);H.appendChild(I)}}function a(){if(Browser.ie6){window.addEvent("scroll",n)}}function A(){var F=new Drag("photoFrame",{handle:$("photoFrame").getElement("div.titleBar"),onComplete:B})}function C(){y();r();e();D();E()}function y(){var G=z.makeResizable({handle:$("photoFrame").getElement("div.dragBarTop"),modifiers:{x:null,y:"height"},invert:true,onComplete:function(){b();w()}});var F=new Drag("photoFrame",{handle:$("photoFrame").getElement("div.dragBarTop"),modifiers:{x:null,y:"top"},onComplete:B})}function r(){var F=q.makeResizable({handle:$("photoFrame").getElement("div.dragBarRight"),modifiers:{x:"width",y:null},onComplete:function(){b();w()}})}function e(){var F=z.makeResizable({handle:$("photoFrame").getElement("div.dragBarBottom"),modifiers:{x:null,y:"height"},onComplete:function(){b();w()}})}function D(){var G=q.makeResizable({handle:$("photoFrame").getElement("div.dragBarLeft"),modifiers:{x:"width",y:null},invert:true,onComplete:function(){b();w()}});var F=new Drag("photoFrame",{handle:$("photoFrame").getElement("div.dragBarLeft"),modifiers:{x:"left",y:null},onComplete:B})}function E(){var G=q.makeResizable({handle:$("photoFrame").getElement("img.dragHandle"),onComplete:function(){b();w()}});var F=z.makeResizable({handle:$("photoFrame").getElement("img.dragHandle")})}function d(){var F=q.getElement("div.titleBar a");F.addEvent("mousedown",function(){F.className="btnDown";q.style.display="none";$("photoContent").set("text","");window.setTimeout(function(){F.className=""},1000);$("search").style.visibility="visible"});F.addEvent("mouseup",function(){F.className=""})}return{initialize:function(){f();a();q=$("photoFrame");z=q.getElement("div.clientArea");i();t();A();C();d();if($("imageMenu")){j();s()}var F=$$("div.photoAlbum");if(F.length>0){k(F)}var G=$$("div#searchControl form")[0];G.addEvent("submit",function(H){if(!SweetAndSour.searchScriptLoaded){H.stop();SweetAndSour.loadSearchScript()}})},searchTerm:"",searchScriptLoaded:false,loadSearchScript:function(){var F=$$("div#searchControl input.gsc-input")[0];SweetAndSour.searchTerm=F.value;if(SweetAndSour.searchTerm===""){return}var G="http://www.google.com/jsapi?key=ABQIAAAAKZa0m7K346FCikKHHE-NgRR8wM3bJBMlRhAtPYyu9yNs3cni-BRTweLyvA1cMNrN0zjIV7JZ2-aRzg";x(G,function(){$("searchControl").innerHTML="Loading &hellip;";google.load("search","1.0",{language:"en",callback:OnLoad})});SweetAndSour.searchScriptLoaded=true},doSearch:function(){var F=$$("div#searchControl input.gsc-input")[0];if(F){F.value=SweetAndSour.searchTerm;var G=$$("div#searchControl input.gsc-search-button")[0];if(G){G.click()}}},ajaxPopup:function(G,H){$("photoContent").set("text","");var F=new Request.HTML({url:G,onSuccess:function(I){$("photoContent").adopt(I)},onFailure:function(){$("photoContent").set("text","The request failed.")}});F.send();$("photoFrame").getElement("span.titleBarText").innerHTML=unescape(H);$("photoFrame").style.display="block";w();$("search").style.visibility="hidden"},getPhoto:function(H,F,M){var G=screen.availWidth;if(G<800){var N=screen.availHeight;var J="../imageMgt/index.php?fuseAction=showPhotoAndCaption&photoName="+H+(M?"&panorama=true":"");var K=window.open(J,"newWindow","width="+G+",height="+N+",left=0,top=0,dependant=yes,directories=no,location=no,menubar=no,resizable=yes,scrollbars=yes,status=no,titlebar=yes,toolbar=no");K.focus()}else{var I="../imageMgt/index.php?fuseAction=showPhotoAndCaptionAjax&photoName="+H+(M?"&panorama=true":"");var L=c(F,60," ...",10);this.ajaxPopup(I,L)}},popup:function(H,G,L,K){if(!K){K="resizable=yes,scrollbars=yes"}var F=(screen.width-G)/2;var J=(screen.height-L)/2;K+=((K)?",":"")+"width="+G+",height="+L+",left="+F+",top="+J;var I;if(typeof(H)=="string"){I=H}else{if(typeof(H)=="object"&&H.tagName.toLowerCase()=="a"){I=H.href}}if(I){if(win){win.location.href=I}else{win=window.open(I,"win",K)}win.focus();return false}},prepareCodeDisplay:function(){var F=$$("div.codeBlock");F.each(function(I,H){var G=I.getElement("h4");var K=new Element("a",{href:"#",html:"Show "+G.innerHTML,events:{click:function(L){l(L);L.stop()}}});G.innerHTML="";G.appendChild(K);var J=I.getElement("div.listing");J.style.display="none"})}}})();window.addEvent("domready",SweetAndSour.initialize);function OnLoad(){var e=new google.search.SearchControl();var c=new google.search.WebSearch();c.setSiteRestriction("sweetandsour.org");c.setUserDefinedLabel("Sweet & Sour articles");var b=new google.search.SearcherOptions();b.setExpandMode(google.search.SearchControl.EXPAND_MODE_OPEN);e.addSearcher(c,b);e.setSearchStartingCallback(this,function(h,g,f){SearchAdditions.searchStart()});e.setSearchCompleteCallback(this,function(g,f){SearchAdditions.searchComplete(g,f)});var d=new google.search.DrawOptions();d.setSearchFormRoot(document.getElementById("searchControl"));d.setDrawMode(google.search.SearchControl.DRAW_MODE_LINEAR);e.draw(document.getElementById("searchResults"),d);var a=$("searchControl").getElement("div.gsc-clear-button");$("searchControl").getElement("td.gsc-clear-button").removeChild(a);$("searchResults").getElement("table.gsc-resultsHeader td.gsc-configLabelCell").appendChild(a);a.addEvent("click",function(f){SearchAdditions.closeResults(f)});SweetAndSour.doSearch()}var SearchAdditions={webSearchDone:false,imgSearchDone:false,searchStart:function(){webSearchDone=false;imgSearchDone=false},searchComplete:function(b,a){if(a.results&&a.results.length>0){if(a.results[0].GsearchResultClass=="GwebSearch"){webSearchDone=true}if(webSearchDone){$("searchResults").style.display="block"}}},showResults:function(a){$("searchResults").style.display="block"},closeResults:function(a){$("searchResults").style.display="none"}};