<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>Self-executing function test</title>
	<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1" />
	<script type="text/javascript">
		// <![CDATA[
		var JSANT = (function() { 

			// PRIVATE STUFF
			var private_sauce = "mushroom";  
			
			function private_writeToPara(str) {  
				var p = document.getElementById("result");
				p.innerHTML = p.innerHTML + str + "<br />"; 
			}
			
			function private_setSauce(str) {
				private_sauce = str;
			}
			
			function private_getSauce() {
				return private_sauce;
			}


			// PUBLIC STUFF
			return {  
				public_outputText : function (str) {  
					if(typeof(str) == "string" && str.length > 0) {
						private_writeToPara(str);
					}
				},  
				
				public_setSauce : function(str) { 
					var approvedSauces = new Array("mushroom", "cheese", "marinara", "tomato", "chilli");
					if(typeof(str) == "string" && str.length > 0) {
						for(sauce in approvedSauces) {
							if(approvedSauces[sauce] == str) {
								private_setSauce(str);
								break;
							}
						}
					}  
				}, 
				
				public_getSauce : function() {  
					if(private_getSauce()) {
						return private_getSauce();
					}
					else {
						return "no sauce";
					}
				}  
			};  
		})(); // the paranthesis will execute the function immediately  

		// -----------------------------------------------------------------------------------------------------------------------------------------------------
		
		function tryIt() {
			JSANT.public_outputText("The sauce today is " + JSANT.public_getSauce());  
			JSANT.public_setSauce("tomato");
			JSANT.public_outputText("The sauce is now " + JSANT.public_getSauce());  
			JSANT.public_setSauce(-27.36); // will be ignored because it is not a string
			JSANT.public_outputText("The sauce is still " + JSANT.public_getSauce());  
			JSANT.public_setSauce("broken glass"); // will be checked against list of approved sauces
			JSANT.public_outputText("The sauce is still " + JSANT.public_getSauce());  
			
			// These are here to prove that the private methods really are private
			try {
				JSANT.private_writeToPara(private_sauce);  
			}
			catch(e) {
				JSANT.public_outputText("Sorry. you can't see my privates.");
			}

			try {
				JSANT.private_writeToPara("Hijack!");  
			}
			catch(e) {
				JSANT.public_outputText("Hey! You can't write directly to paragraph");
			}

			try {
				JSANT.private_setSauce("rat poison");  // Can't bypass the checks in the public function
			}
			catch(e) {
				JSANT.public_outputText("Phew. I'm glad that was protected.");
			}
		}
		// ]]>
	</script>
</head>
<body onload="tryIt()">
	<h1>Self-executing function test</h1>
	<p>View the source to see how the public and private sections.</p>
	<p id="result"></p>
	
</body>
</html>